<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Rediscover • Gear Builder</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body { background:#0c0f14; color:#fff; font-family:sans-serif; text-align:center; margin:0; }
  h1 { margin:20px 0; font-size:22px; }
  .builder {
    position: relative;
    width: 320px; height: 420px;
    margin: 40px auto;
  }
  .slot {
    position: absolute;
    width: 80px; height: 80px;
    border: 1px solid #555;
    background: #1a1f2e;
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer;
    font-size: 13px;
    text-align: center;
    padding: 4px;
  }
  .hunter {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 100px; height: 100px;
    background: url('assets/hunter.png') center/contain no-repeat;
  }
  /* Ring positions */
  .Helm { top: 0; left: 50%; transform: translate(-50%, 0); }
  .Necklace { top: 70px; left: 0; }
  .Chest { top: 70px; right: 0; }
  .Weapon { top: 160px; left: 0; }
  .Gloves { top: 160px; right: 0; }
  .Ring { top: 250px; left: 0; }
  .Boots { top: 250px; right: 0; }
  .Belt { bottom: 0; left: 50%; transform: translate(-50%, 0); }

  #modal {
    position:fixed; inset:0; background:rgba(0,0,0,0.8);
    display:none; align-items:center; justify-content:center;
  }
  #modal .inner {
    background:#222; padding:20px; border-radius:12px;
    width:95%; max-width:500px; text-align:left;
    color:#fff;
  }
  label { display:block; margin-top:8px; font-weight:bold; }
  select,input { width:100%; margin:4px 0; padding:6px; border-radius:6px; }
  button { padding:10px 16px; margin:8px 4px; border:0; border-radius:8px; font-weight:bold; cursor:pointer; }
  .save { background:#22c55e; }
  .close { background:#ef4444; }
</style>
</head>
<body>
  <h1>Rediscover • Gear Builder</h1>

  <div class="builder">
    <div class="hunter"></div>
    <div class="slot Helm" data-slot="Helm">Helm</div>
    <div class="slot Necklace" data-slot="Necklace">Necklace</div>
    <div class="slot Chest" data-slot="Chest">Chest</div>
    <div class="slot Weapon" data-slot="Weapon">Weapon</div>
    <div class="slot Gloves" data-slot="Gloves">Gloves</div>
    <div class="slot Ring" data-slot="Ring">Ring</div>
    <div class="slot Boots" data-slot="Boots">Boots</div>
    <div class="slot Belt" data-slot="Belt">Belt</div>
  </div>

  <div id="modal">
    <div class="inner">
      <h2 id="modalTitle"></h2>
      <label>Tier</label>
      <select id="tierSelect"></select>

      <label>Rune</label>
      <select id="runeSelect"></select>
      <input id="runeValue" type="number" placeholder="Value">

      <label>Special / Option</label>
      <input id="specialInput" type="text">

      <div id="lines"></div>

      <div style="margin-top:10px;">
        <button class="save" id="saveBtn">Save</button>
        <button class="close" id="closeBtn">Close</button>
      </div>
    </div>
  </div>

<script>
let gearDefs={}, chosenGear={}, statOptions=[];

async function loadDefs(){
  const res=await fetch("gearDefs.json");
  gearDefs=await res.json();

  // Build Tier dropdown
  const tierSelect=document.getElementById("tierSelect");
  for(const tier of Object.keys(gearDefs.GearStats||{})){
    const opt=document.createElement("option");
    opt.value=tier; opt.text=tier;
    tierSelect.appendChild(opt);
  }

  // Simple rune list for now
  const runes=["None","ATK SPD","Crit Chance","Evasion","DR"];
  const runeSelect=document.getElementById("runeSelect");
  runes.forEach(r=>{
    const o=document.createElement("option");o.value=r;o.text=r;
    runeSelect.appendChild(o);
  });

  // Collect stat keys
  const statSet=new Set();
  for(const tier in gearDefs.GearStats){
    const obj=gearDefs.GearStats[tier];
    for(const s in obj.stats){ if(s) statSet.add(s); }
  }
  statOptions=[...statSet];
}
loadDefs();

const modal=document.getElementById("modal");
const modalTitle=document.getElementById("modalTitle");
let currentSlot=null;

// Slot click
document.querySelectorAll(".slot").forEach(slot=>{
  slot.addEventListener("click",()=>{
    currentSlot=slot.dataset.slot;
    modalTitle.textContent="Edit "+currentSlot;
    buildLines();
    modal.style.display="flex";
  });
});

// Build 4 line inputs
function buildLines(){
  const linesDiv=document.getElementById("lines");
  linesDiv.innerHTML="";
  for(let i=1;i<=4;i++){
    const wrap=document.createElement("div");
    wrap.innerHTML=`<label>Line ${i}</label>`;
    const sel=document.createElement("select");
    statOptions.forEach(s=>{
      const o=document.createElement("option");
      o.value=s; o.text=s; sel.appendChild(o);
    });
    const val=document.createElement("input");
    val.type="number"; val.placeholder="Value";
    val.id=`line${i}Val`;
    sel.id=`line${i}Stat`;
    wrap.appendChild(sel); wrap.appendChild(val);
    linesDiv.appendChild(wrap);
  }
}

// Save
document.getElementById("saveBtn").addEventListener("click",()=>{
  if(!currentSlot) return;
  const slotData={
    tier: document.getElementById("tierSelect").value,
    rune: document.getElementById("runeSelect").value,
    runeValue: document.getElementById("runeValue").value,
    special: document.getElementById("specialInput").value,
    lines:[]
  };
  for(let i=1;i<=4;i++){
    slotData.lines.push({
      stat: document.getElementById(`line${i}Stat`).value,
      value: document.getElementById(`line${i}Val`).value
    });
  }
  chosenGear[currentSlot]=slotData;
  document.querySelector(`.slot[data-slot='${currentSlot}']`).textContent=
    slotData.tier+" "+currentSlot;
  modal.style.display="none";
});

document.getElementById("closeBtn").addEventListener("click",()=>modal.style.display="none");
</script>
</body>
</html>
