<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Rediscover • Gear Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="style.css" rel="stylesheet">
  <style>
    body { background:#0c0f14; color:#fff; font-family:sans-serif; text-align:center; }
    h1 { margin:20px 0; font-size:22px; }
    .builder { display:grid; grid-template-columns:repeat(3,1fr); gap:20px; max-width:500px; margin:30px auto; }
    .slot { border:1px solid #555; padding:20px; border-radius:12px; cursor:pointer; background:#1a1f2e; }
    #modal { position:fixed; inset:0; background:rgba(0,0,0,0.8); display:none; align-items:center; justify-content:center; }
    #modal .inner { background:#222; padding:20px; border-radius:12px; width:90%; max-width:500px; text-align:left; }
    select,input { width:100%; margin:6px 0; padding:8px; border-radius:6px; }
    button { padding:10px 16px; margin:8px 4px; border:0; border-radius:8px; font-weight:bold; cursor:pointer; }
    .save { background:#22c55e; }
    .close { background:#ef4444; }
  </style>
</head>
<body>
  <h1>Rediscover • Gear Builder</h1>

  <div class="builder">
    <div class="slot" data-slot="Weapon">Weapon</div>
    <div class="slot" data-slot="Helm">Helm</div>
    <div class="slot" data-slot="Chest">Chest</div>
    <div class="slot" data-slot="Gloves">Gloves</div>
    <div class="slot" data-slot="Boots">Boots</div>
    <div class="slot" data-slot="Belt">Belt</div>
    <div class="slot" data-slot="Necklace">Necklace</div>
    <div class="slot" data-slot="Ring">Ring</div>
  </div>

  <div id="modal">
    <div class="inner">
      <h2 id="modalTitle"></h2>
      <label>Pick Item:</label>
      <select id="itemSelect"></select>
      <label>Tier/Type:</label>
      <input id="tierBox" readonly>
      <label>Special/Ability:</label>
      <input id="abilityBox" readonly>
      <div style="margin-top:10px;">
        <button class="save" id="saveBtn">Save</button>
        <button class="close" id="closeBtn">Close</button>
      </div>
    </div>
  </div>

  <script>
    let gearDefs={}, chosenGear={};
    async function loadDefs(){
      const res=await fetch("gearDefs.json");
      gearDefs=await res.json();
    }
    loadDefs();

    const modal=document.getElementById("modal");
    const itemSelect=document.getElementById("itemSelect");
    const tierBox=document.getElementById("tierBox");
    const abilityBox=document.getElementById("abilityBox");
    const modalTitle=document.getElementById("modalTitle");

    let currentSlot=null;

    document.querySelectorAll(".slot").forEach(slot=>{
      slot.addEventListener("click",()=>{
        currentSlot=slot.dataset.slot;
        modalTitle.textContent="Edit "+currentSlot;
        buildOptions(currentSlot);
        modal.style.display="flex";
      });
    });

    function buildOptions(slot){
      itemSelect.innerHTML="";
      // Tier-based gear
      for(const [tier,obj] of Object.entries(gearDefs.GearStats)){
        if(obj.slot && obj.slot.toLowerCase().includes(slot.toLowerCase())){
          const opt=document.createElement("option");
          opt.value=`${tier} ${slot}`;
          opt.text=`${tier} ${slot}`;
          opt.dataset.tier=tier;
          opt.dataset.ability=obj.purple_line||"";
          itemSelect.appendChild(opt);
        }
      }
      // Unique gear
      for(const [name,u] of Object.entries(gearDefs.UniqueGear)){
        if(u.slot && u.slot.toLowerCase()===slot.toLowerCase()){
          const opt=document.createElement("option");
          opt.value=name;
          opt.text=name;
          opt.dataset.tier=u.tier;
          opt.dataset.ability=u.ability||u.unique_skill||"";
          itemSelect.appendChild(opt);
        }
      }
      // Weapons: World Boss/PvP
      if(slot==="Weapon"){
        for(const [name,w] of Object.entries(gearDefs.WorldBossWeapons)){
          const opt=document.createElement("option");
          opt.value=name;
          opt.text=`WB • ${name}`;
          opt.dataset.tier=w.type;
          opt.dataset.ability=w.proc?.skill||"";
          itemSelect.appendChild(opt);
        }
        for(const [name,w] of Object.entries(gearDefs.PvPWeapons)){
          const opt=document.createElement("option");
          opt.value=name;
          opt.text=`PvP • ${name}`;
          opt.dataset.tier=w.type;
          opt.dataset.ability=w.proc?.skill||"";
          itemSelect.appendChild(opt);
        }
      }
      updateDetails();
    }

    function updateDetails(){
      const opt=itemSelect.options[itemSelect.selectedIndex];
      tierBox.value=opt?.dataset.tier||"";
      abilityBox.value=opt?.dataset.ability||"";
    }
    itemSelect.addEventListener("change",updateDetails);

    document.getElementById("saveBtn").addEventListener("click",()=>{
      if(!currentSlot) return;
      chosenGear[currentSlot]=itemSelect.value;
      document.querySelector(`.slot[data-slot='${currentSlot}']`).textContent=itemSelect.value;
      modal.style.display="none";
    });
    document.getElementById("closeBtn").addEventListener("click",()=>modal.style.display="none");
  </script>
</body>
</html>
