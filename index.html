<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Rediscover • Gear Builder</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body { background:#0c0f14; color:#fff; font-family:sans-serif; text-align:center; margin:0; }
  h1 { margin:20px 0; font-size:22px; }
  .builder {
    position: relative;
    width: 300px; height: 400px;
    margin: 40px auto;
  }
  .slot {
    position: absolute;
    width: 80px; height: 80px;
    border: 1px solid #555;
    background: #1a1f2e;
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer;
    font-size: 14px;
    text-align: center;
    padding: 4px;
  }
  .hunter {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 100px; height: 100px;
    background: url('assets/hunter.png') center/contain no-repeat;
  }
  /* EHT ring positions */
  .Helm { top: 0; left: 50%; transform: translate(-50%, 0); }
  .Necklace { top: 70px; left: 0; }
  .Chest { top: 70px; right: 0; }
  .Weapon { top: 150px; left: 0; }
  .Gloves { top: 150px; right: 0; }
  .Ring { top: 230px; left: 0; }
  .Boots { top: 230px; right: 0; }
  .Belt { bottom: 0; left: 50%; transform: translate(-50%, 0); }

  #modal {
    position:fixed; inset:0; background:rgba(0,0,0,0.8);
    display:none; align-items:center; justify-content:center;
  }
  #modal .inner {
    background:#222; padding:20px; border-radius:12px;
    width:90%; max-width:500px; text-align:left;
  }
  select,input { width:100%; margin:6px 0; padding:8px; border-radius:6px; }
  button { padding:10px 16px; margin:8px 4px; border:0; border-radius:8px; font-weight:bold; cursor:pointer; }
  .save { background:#22c55e; }
  .close { background:#ef4444; }
</style>
</head>
<body>
  <h1>Rediscover • Gear Builder</h1>

  <div class="builder">
    <div class="hunter"></div>
    <div class="slot Helm" data-slot="Helm">Helm</div>
    <div class="slot Necklace" data-slot="Necklace">Necklace</div>
    <div class="slot Chest" data-slot="Chest">Chest</div>
    <div class="slot Weapon" data-slot="Weapon">Weapon</div>
    <div class="slot Gloves" data-slot="Gloves">Gloves</div>
    <div class="slot Ring" data-slot="Ring">Ring</div>
    <div class="slot Boots" data-slot="Boots">Boots</div>
    <div class="slot Belt" data-slot="Belt">Belt</div>
  </div>

  <div id="modal">
    <div class="inner">
      <h2 id="modalTitle"></h2>
      <label>Pick Item:</label>
      <select id="itemSelect"></select>
      <label>Tier/Type:</label>
      <input id="tierBox" readonly>
      <label>Special/Ability:</label>
      <input id="abilityBox" readonly>
      <div style="margin-top:10px;">
        <button class="save" id="saveBtn">Save</button>
        <button class="close" id="closeBtn">Close</button>
      </div>
    </div>
  </div>

  <script>
    let gearDefs={}, chosenGear={};
    async function loadDefs(){
      const res=await fetch("gearDefs.json");
      gearDefs=await res.json();
    }
    loadDefs();

    const modal=document.getElementById("modal");
    const itemSelect=document.getElementById("itemSelect");
    const tierBox=document.getElementById("tierBox");
    const abilityBox=document.getElementById("abilityBox");
    const modalTitle=document.getElementById("modalTitle");

    let currentSlot=null;

    document.querySelectorAll(".slot").forEach(slot=>{
      slot.addEventListener("click",()=>{
        currentSlot=slot.dataset.slot;
        modalTitle.textContent="Edit "+currentSlot;
        buildOptions(currentSlot);
        modal.style.display="flex";
      });
    });

    function buildOptions(slot){
      itemSelect.innerHTML="";
      // Tier-based gear
      for(const [tier,obj] of Object.entries(gearDefs.GearStats||{})){
        if(obj.slot && obj.slot.toLowerCase().includes(slot.toLowerCase())){
          const opt=document.createElement("option");
          opt.value=`${tier} ${slot}`;
          opt.text=`${tier} ${slot}`;
          opt.dataset.tier=tier;
          opt.dataset.ability=obj.purple_line||"";
          itemSelect.appendChild(opt);
        }
      }
      // Unique gear
      for(const [name,u] of Object.entries(gearDefs.UniqueGear||{})){
        if(u.slot && u.slot.toLowerCase()===slot.toLowerCase()){
          const opt=document.createElement("option");
          opt.value=name;
          opt.text=name;
          opt.dataset.tier=u.tier;
          opt.dataset.ability=u.ability||u.unique_skill||"";
          itemSelect.appendChild(opt);
        }
      }
      // Weapons: World Boss/PvP
      if(slot==="Weapon"){
        for(const [name,w] of Object.entries(gearDefs.WorldBossWeapons||{})){
          const opt=document.createElement("option");
          opt.value=name;
          opt.text=`WB • ${name}`;
          opt.dataset.tier=w.type;
          opt.dataset.ability=w.proc?.skill||"";
          itemSelect.appendChild(opt);
        }
        for(const [name,w] of Object.entries(gearDefs.PvPWeapons||{})){
          const opt=document.createElement("option");
          opt.value=name;
          opt.text=`PvP • ${name}`;
          opt.dataset.tier=w.type;
          opt.dataset.ability=w.proc?.skill||"";
          itemSelect.appendChild(opt);
        }
      }
      updateDetails();
    }

    function updateDetails(){
      const opt=itemSelect.options[itemSelect.selectedIndex];
      tierBox.value=opt?.dataset.tier||"";
      abilityBox.value=opt?.dataset.ability||"";
    }
    itemSelect.addEventListener("change",updateDetails);

    document.getElementById("saveBtn").addEventListener("click",()=>{
      if(!currentSlot) return;
      chosenGear[currentSlot]=itemSelect.value;
      document.querySelector(`.slot[data-slot='${currentSlot}']`).textContent=itemSelect.value;
      modal.style.display="none";
    });
    document.getElementById("closeBtn").addEventListener("click",()=>modal.style.display="none");
  </script>
</body>
</html>