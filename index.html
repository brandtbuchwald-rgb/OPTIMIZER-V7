<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Rediscover • Gear Builder</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600&family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
  body { margin:0; background:#0c0f14; color:#e8ecf8; font-family:Inter,sans-serif; }
  h1 { text-align:center; margin:20px; font-family:Cinzel,serif; color:#fcd34d; }

  /* Gear Ring */
  .builder { position:relative; width:320px; height:420px; margin:40px auto; }
  .slot { position:absolute; width:80px; height:80px;
    border:1px solid rgba(255,255,255,0.15); background:#1a1f2e;
    border-radius:12px; display:flex; align-items:center; justify-content:center;
    cursor:pointer; font-size:13px; text-align:center; padding:4px;
    transition:background .2s, box-shadow .2s, border-color .3s;
    overflow:hidden; position:relative;
  }
  .slot:hover { background:#232a3d; }
  .hunter { position:absolute; top:50%; left:50%; transform:translate(-50%, -50%);
    width:100px; height:100px; background:url('assets/hunter.png') center/contain no-repeat; }

  /* Clear button inside slot */
  .clearBtn {
    position:absolute; top:2px; right:4px;
    font-size:14px; color:#aaa; cursor:pointer;
    display:none;
  }
  .slot.filled .clearBtn { display:block; }

  /* Ring positions */
  .Helm { top:0; left:50%; transform:translate(-50%,0); }
  .Necklace { top:70px; left:0; }
  .Chest { top:70px; right:0; }
  .Weapon { top:160px; left:0; }
  .Gloves { top:160px; right:0; }
  .Ring { top:250px; left:0; }
  .Boots { top:250px; right:0; }
  .Belt { bottom:0; left:50%; transform:translate(-50%,0); }

  /* Modal */
  #modal { position:fixed; inset:0; background:rgba(0,0,0,.75);
    display:none; align-items:center; justify-content:center; z-index:100; }
  #modal .card { background:rgba(19,24,37,.95); border:1px solid rgba(255,255,255,.1);
    border-radius:16px; padding:20px; width:95%; max-width:520px;
    box-shadow:0 20px 40px rgba(0,0,0,.5);
    transition: box-shadow .3s, border-color .3s;
  }
  #modal h2 { margin-top:0; font-family:Cinzel,serif; }
  .section { display:grid; grid-template-columns:120px 1fr; gap:12px; margin-bottom:12px; }
  .section label { font-weight:600; font-size:14px; color:#a8b0c2; text-align:right; }
  .field-row { display:flex; gap:8px; }
  select,input { width:100%; padding:8px; border-radius:8px; border:1px solid #444;
    background:#121826; color:#e8ecf8; font-weight:600; }
  .btn-row { text-align:right; margin-top:20px; }
  button { padding:10px 16px; border:0; border-radius:8px; font-weight:bold; cursor:pointer; }

  /* Accent themes */
  :root { --accent:#c6a15b; --accentGlow:rgba(198,161,91,.4); }
  .theme-Primal { --accent:#c6a15b; --accentGlow:rgba(198,161,91,.4); }
  .theme-Original { --accent:#ef4444; --accentGlow:rgba(239,68,68,.4); }
  .theme-Chaos { --accent:#14b8a6; --accentGlow:rgba(20,184,166,.4); }
  .theme-Abyss { --accent:#7c3aed; --accentGlow:rgba(124,58,237,.4); }

  #modal .card h2 { color:var(--accent); }
  #modal .card { border-color:var(--accent); box-shadow:0 0 20px var(--accentGlow); }
  .save { background:var(--accent); color:#fff; }
  .close { background:#555; color:#fff; margin-left:8px; }

  /* Slot glows */
  .slot.theme-Primal { border-color:#c6a15b; box-shadow:0 0 12px rgba(198,161,91,.5); }
  .slot.theme-Original { border-color:#ef4444; box-shadow:0 0 12px rgba(239,68,68,.5); }
  .slot.theme-Chaos { border-color:#14b8a6; box-shadow:0 0 12px rgba(20,184,166,.5); }
  .slot.theme-Abyss { border-color:#7c3aed; box-shadow:0 0 12px rgba(124,58,237,.5); }

  /* Hunter pulse */
  .hunter.pulse { border-radius:50%; animation:pulseGlow 2s infinite; }
  @keyframes pulseGlow {
    0% { box-shadow:0 0 15px var(--accentGlow); }
    50% { box-shadow:0 0 35px var(--accentGlow), 0 0 70px var(--accentGlow); }
    100% { box-shadow:0 0 15px var(--accentGlow); }
  }
</style>
</head>
<body>
  <h1>Rediscover • Gear Builder</h1>

  <div class="builder">
    <div class="hunter"></div>
    <div class="slot Helm" data-slot="Helm">Helm<span class="clearBtn">×</span></div>
    <div class="slot Necklace" data-slot="Necklace">Necklace<span class="clearBtn">×</span></div>
    <div class="slot Chest" data-slot="Chest">Chest<span class="clearBtn">×</span></div>
    <div class="slot Weapon" data-slot="Weapon">Weapon<span class="clearBtn">×</span></div>
    <div class="slot Gloves" data-slot="Gloves">Gloves<span class="clearBtn">×</span></div>
    <div class="slot Ring" data-slot="Ring">Ring<span class="clearBtn">×</span></div>
    <div class="slot Boots" data-slot="Boots">Boots<span class="clearBtn">×</span></div>
    <div class="slot Belt" data-slot="Belt">Belt<span class="clearBtn">×</span></div>
  </div>

  <div id="modal">
    <div class="card theme-Primal" id="modalCard">
      <h2 id="modalTitle"></h2>

      <div class="section">
        <label>Tier</label>
        <select id="tierSelect"></select>
      </div>

      <div class="section">
        <label>Rune</label>
        <div class="field-row">
          <select id="runeSelect"></select>
          <input id="runeValue" type="number" placeholder="Value">
        </div>
      </div>

      <div class="section">
        <label>Special</label>
        <input id="specialInput" type="text">
      </div>

      <div id="lines"></div>

      <div class="btn-row">
        <button class="save" id="saveBtn">Save</button>
        <button class="close" id="closeBtn">Close</button>
      </div>
    </div>
  </div>

<script>
let gearDefs={}, chosenGear={}, statOptions=[];

async function loadDefs(){
  const res=await fetch("gearDefs.json");
  gearDefs=await res.json();

  // Tiers
  const tierSelect=document.getElementById("tierSelect");
  for(const tier of Object.keys(gearDefs.GearStats||{})){
    const opt=document.createElement("option");
    opt.value=tier; opt.text=tier; tierSelect.appendChild(opt);
  }

  // Rune list
  const runes=["None","ATK SPD","Crit Chance","Evasion","DR"];
  const runeSelect=document.getElementById("runeSelect");
  runes.forEach(r=>{ const o=document.createElement("option");o.value=r;o.text=r;runeSelect.appendChild(o); });

  // Stat keys
  const statSet=new Set();
  for(const tier in gearDefs.GearStats){ const obj=gearDefs.GearStats[tier];
    for(const s in obj.stats){ if(s) statSet.add(s); }
  }
  statOptions=[...statSet];
}
loadDefs();

const modal=document.getElementById("modal");
const modalTitle=document.getElementById("modalTitle");
const modalCard=document.getElementById("modalCard");
let currentSlot=null;

// Slot click opens modal
document.querySelectorAll(".slot").forEach(slot=>{
  slot.addEventListener("click",(e)=>{
    if(e.target.classList.contains("clearBtn")) return; // skip if clicking clear
    currentSlot=slot.dataset.slot;
    modalTitle.textContent="Edit "+currentSlot;
    buildLines();
    modal.style.display="flex";
  });
});

// Build 4 lines
function buildLines(){
  const linesDiv=document.getElementById("lines");
  linesDiv.innerHTML="";
  for(let i=1;i<=4;i++){
    const row=document.createElement("div");
    row.className="section";
    const label=document.createElement("label");
    label.textContent="Line "+i;
    const field=document.createElement("div");
    field.className="field-row";
    const sel=document.createElement("select"); sel.id=`line${i}Stat`;
    statOptions.forEach(s=>{ const o=document.createElement("option");o.value=s;o.text=s;sel.appendChild(o); });
    const val=document.createElement("input"); val.type="number"; val.placeholder="Value"; val.id=`line${i}Val`;
    field.appendChild(sel); field.appendChild(val);
    row.appendChild(label); row.appendChild(field);
    linesDiv.appendChild(row);
  }
}

// Accent theme switching
document.getElementById("tierSelect").addEventListener("change",(e)=>{
  const tier=e.target.value;
  modalCard.className="card theme-"+tier;
});

// Save gear
document.getElementById("saveBtn").addEventListener("click",()=>{
  if(!currentSlot) return;
  const slotData={
    tier: document.getElementById("tierSelect").value,
    rune: document.getElementById("runeSelect").value,
    runeValue: document.getElementById("runeValue").value,
    special: document.getElementById("specialInput").value,
    lines:[]
  };
  for(let i=1;i<=4;i++){
    slotData.lines.push({
      stat: document.getElementById(`line${i}Stat`).value,
      value: document.getElementById(`line${i}Val`).value
    });
  }
  chosenGear[currentSlot]=slotData;

  // Update slot box
  const slotEl=document.querySelector(`.slot[data-slot='${currentSlot}']`);
  slotEl.innerHTML=slotData.tier+" "+currentSlot+"<span class='clearBtn'>×</span>";
  slotEl.className="slot "+currentSlot+" theme-"+slotData.tier+" filled";

  // Hunter pulse for weapon
  if(currentSlot==="Weapon"){
    const hunter=document.querySelector(".hunter");
    hunter.className="hunter pulse theme-"+slotData.tier;
  }

  modal.style.display="none";
  attachClearHandlers();
});

// Close modal
document.getElementById("closeBtn").addEventListener("click",()=>modal.style.display="none");

// Clear buttons
function attachClearHandlers(){
  document.querySelectorAll(".clearBtn").forEach(btn=>{
    btn.onclick=(e)=>{
      e.stopPropagation();
      const slotEl=btn.parentElement;
      const slot=slotEl.dataset.slot;
      delete chosenGear[slot];
      slotEl.textContent=slot+"<span class='clearBtn'>×</span>";
      slotEl.className="slot "+slot;
      attachClearHandlers();
      if(slot==="Weapon"){
        document.querySelector(".hunter").className="hunter";
      }
    }
  });
}
attachClearHandlers();
</script>
</body>
</html>
